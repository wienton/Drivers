README: CHARACTER DEVICE DRIVER & NETFILTER HOOK SYSTEM

1. ВВЕДЕНИЕ (RED TEAM CONTEXT)
Данный модуль является прототипом LKM-руткита. Он демонстрирует возможности скрытого мониторинга сетевого трафика и обхода системных защит на уровне нулевого кольца (Ring 0). В среде Kali Linux модуль используется для изучения методов сокрытия присутствия в системе и перехвата управления ядром.


2. ПОДГОТОВКА KALI LINUX
Перед компиляцией убедитесь, что репозитории обновлены, и установлены Headers (заголовки) вашего текущего ядра. Без них линковка с ядром невозможна.

# Обновление системы и установка зависимостей
sudo apt update
sudo apt install build-essential kmod linux-headers-$(uname -r)


3. СБОРКА (KBUILD НА KALI)
В Kali обычно используется классический GCC-стек.

# Сборка модуля
make

# Очистка мусора
make clean

*Если компилятор ругается на отсутствие Clang (редко в Kali), используй make CC=gcc.*


4. ИНСТРУКЦИЯ ПО РАБОТЕ В СРЕДЕ KALI


ШПИОНСКИЙ АУДИТ (DMESG)
В Kali логи ядра — твой главный помощник. Чтобы не засирать экран, используй фильтрацию:
# Следить только за сообщениями нашего модуля
sudo dmesg -w | grep -i "ACCELA"


СКРЫТАЯ ПРОВЕРКА (LSMOD)
Любой админ проверит список модулей. Ты должен подумать, как скрыть файл из этого списка (подсказка: манипуляция со списком THIS_MODULE->list).
lsmod | grep linux_driver


ТЕСТИРОВАНИЕ СЕТЕВОГО ФИЛЬТРА (SCAPY)
Поскольку наш драйвер ищет в пакетах магическую сигнатуру 0xDEADC0DE, проверь его работу через Scapy (предустановлен в Kali):
# Запусти scapy в терминале (sudo scapy)
send(IP(dst="127.0.0.1")/TCP(dport=80)/"DEADC0DE")

Если драйвер работает, в dmesg вылетит сообщение о перехвате «зашифрованного» пакета.


5. ТЕРМИНОЛОГИЯ ДЛЯ KALI-ПОЛЬЗОВАТЕЛЯ (HARDCORE)

1.  Ring 0 Hijacking: Получение максимальных привилегий за счет исполнения кода в контексте ядра.
2.  Kernel Land Persistence: Метод закрепления в системе через загружаемые модули.
3.  LSM (Linux Security Modules): Системы защиты (AppArmor/SELinux), которые твой драйвер обходит, работая на уровне Netfilter.
4.  Packet Dropping: Использование NF_DROP для скрытой фильтрации трафика (реализация LKM-файрвола).
5.  Symbol Lookup (kallsyms): Поиск скрытых адресов функций в ядре, которые не документированы для обычных пользователей.


6. МЕРЫ ПРЕДОСТОРОЖНОСТИ
В Kali Linux Kernel Panic случается так же часто, как и везде.
–   Снэпшоты: Если работаешь в VM (VirtualBox/VMware), сделай Snapshot перед insmod.
–   SSH: Если вешаешь хук на сеть, убедись, что не дропаешь свой собственный SSH-трафик, иначе потеряешь доступ к машине.


Задание: Модифицируй код так, чтобы драйвер не просто логировал пакеты с 0xDEADC0DE, а скрытно перенаправлял их на другой IP-адрес (реализация редиректа на уровне ядра).
